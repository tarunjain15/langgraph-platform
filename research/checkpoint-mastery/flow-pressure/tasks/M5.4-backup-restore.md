```yaml
task_id: M5.4
phase: M5
type: Reliability
status: pending
created: 2025-11-17
```

# Task 5.4: [Reliability] Backup & Restore

## The Constraint

**Before:** No tested backup strategy → data loss risk
**After:** Automated daily backups + verified restore capability → disaster recovery ready

---

## The Witness

**Observable Truth:** Restore from 24-hour-old backup succeeds, all checkpoints recovered

---

## Acceptance Criteria

- [ ] Automated daily backups configured (RDS automated backups)
- [ ] Backup retention 7 days minimum
- [ ] Restore test successful (create new instance from backup)
- [ ] Restored data verified (count match)
- [ ] Point-in-time recovery capability documented

---

## Code Pattern

```bash
# RDS Automated Backups (Terraform)
resource "aws_db_instance" "checkpoints" {
  backup_retention_period = 7
  backup_window          = "03:00-04:00"  # 3am UTC
  copy_tags_to_snapshot  = true

  # Point-in-time recovery via transaction logs
  enabled_cloudwatch_logs_exports = ["postgresql"]
}

# Manual backup (on-demand)
aws rds create-db-snapshot \
  --db-instance-identifier checkpoints-db \
  --db-snapshot-identifier checkpoints-manual-2025-11-17

# Restore test
aws rds restore-db-instance-from-db-snapshot \
  --db-instance-identifier checkpoints-restore-test \
  --db-snapshot-identifier rds:checkpoints-db-2025-11-16-03-00

# Verify restored data
psql postgresql://user:password@restored-host:5432/checkpoints \
  -c "SELECT COUNT(*) FROM checkpoints"
# Compare with production count
```

---

## The Completion Signal

**Signal:** Restore from backup succeeds, data integrity verified

**Evidence:** Restore test log, count verification, RDS backup configuration

---

## Notes

**Test Restore:** Backup without restore test is unverified. Test quarterly minimum.

**RPO:** 24 hours with daily backups. For lower RPO, use point-in-time recovery (5-minute granularity).
