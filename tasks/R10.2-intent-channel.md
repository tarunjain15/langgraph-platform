```yaml
task_id: R10.2
phase: R10
type: Integration
status: complete
created: 2025-11-24
completed: 2025-11-24
witness_verified: true
agents_tested: 3
```

# Task R10.2: [Integration] Intent Channel

## The Constraint

**Before:** Nodes execute actions immediately without planning phase
**After:** Agent nodes generate action plans, write to intent channel, defer execution

---

## The Witness

**Observable Truth:** Agent generates plan → intent channel accumulates plan → execution NOT triggered

**Why This Witness:**
- Plan exists in channel but action NOT executed proves separation of intent/execution
- Multiple agents can plan concurrently without executing proves coordination readiness
- Channel accumulation (Topic reducer) proves all plans retained for coordinator

---

## Acceptance Criteria

**Must Verify:**
- [x] AgentNode generates action plan as dict with agent_id, action, reason, timestamp
- [x] intent_channel configured with Topic reducer (retains all plans)
- [x] Multiple agents write plans without conflicts (3 agents tested)
- [x] Plans queryable by coordinator before execution
- [x] No execution side effects when plans written (file unchanged, no backup created)

**Cannot Exist Without:**
- Plan in channel without execution is **impossible** without intent/execution separation
- Multiple plans coexisting is **automatic** with Topic channel
- Plan inspection is **measurable** via channel query

---

## Code Pattern

```python
# Minimal code to unlock the witness
from langgraph.graph import StateGraph
from typing import TypedDict
import time

class AgentState(TypedDict):
    observations: list[dict]  # From R10.1
    intents: list[dict]       # Topic channel - all plans

class AgentNode:
    def __init__(self, agent_id: str):
        self.agent_id = agent_id

    async def plan(self, state: AgentState) -> dict:
        # Read observations, decide action
        if state.get("observations"):
            latest = state["observations"][-1]
            action = self.decide_action(latest)

            # Write plan to intent channel (no execution)
            return {
                "intents": [{
                    "agent_id": self.agent_id,
                    "action": action,
                    "reason": f"Responding to {latest['type']}",
                    "timestamp": time.time()
                }]
            }
        return {}

    def decide_action(self, observation):
        # Decision logic (no side effects)
        return {"type": "modify_file", "target": observation["path"]}

# Graph with intent channel
workflow = StateGraph(AgentState)
workflow.add_node("agent_1", AgentNode("agent_1").plan)
workflow.add_node("agent_2", AgentNode("agent_2").plan)
```

---

## Execution Protocol

**Prerequisites:**
- R10.1 complete (observation channel functional)
- StateGraph with Topic channels
- Agent decision logic implemented

**Execution Steps:**
1. Create AgentNode class with plan() method
2. Implement decide_action() with NO side effects
3. Create StateGraph with Topic channel for intents
4. Add multiple agent nodes
5. Connect agents to observation channel

**Verification Steps:**
1. Trigger observation event
2. Verify agents generate plans
3. Query intent channel
4. Confirm NO execution occurred (file not modified)
5. Verify all agent plans present in channel

---

## The Completion Signal

**Signal:** Multiple agents write plans to intent channel without executing actions

**Evidence Required:**
- workflows/intent_test.py (multiple agents planning)
- intent_channel_state.json (showing all plans)
- verification_no_execution.log (proving no side effects)

**State Transition:**
```yaml
before:
  status: roadmap
  witness: impossible (agents execute immediately)

after:
  status: complete
  witness: observed (plans in channel, no execution)
  evidence:
    - workflows/intent_test.py
    - intent_channel_state.json
    - verification_no_execution.log
```

---

## Constraint Compliance

**CONTEXT_PRESERVATION:** Intent channel preserves all plans via Topic reducer
**CONSTRAINT_INHERITANCE:** Agents respect decision boundaries (no execution in plan())
**TRACE_REQUIRED:** Every plan includes agent_id, action, reason, timestamp
**RESOURCE_STEWARDSHIP:** Planning is pure computation (no I/O)
**RESIDUE_FREE:** No side effects, all state in channel

---

## Notes

**Critical Separation:** plan() must have ZERO side effects. This enables void tool (R11) and safe what-if analysis.

**Coordination Readiness:** Intent channel makes conflicts visible BEFORE execution. Coordinator (R10.3) can resolve.
